<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <title>My first three.js app</title>
    <style>
        body {
            margin: 0;
        }

        #info {
            position: absolute;
            top: 50%;
            width: 100%;
            text-align: center;
            z-index: 100;
            display: block;
            color: white;
            font-size: 50px;
            font-family: monospace;
        }
    </style>

    <link rel="stylesheet" media="screen" href="style.css">
</head>

<body>
    <div id="particles-js"></div>
    <script src="js/particles.js"></script>
    <script src="js/app.js"></script>

    <script type="module">

        import * as THREE from 'https://cdn.skypack.dev/three@0.130.0';
        import { OrbitControls } from 'https://cdn.skypack.dev/three@0.130.0/examples/jsm/controls/OrbitControls.js';
        import { GLTFLoader } from 'https://cdn.skypack.dev/three@0.130.0/examples/jsm/loaders/GLTFLoader.js';


        // Our Javascript will go here.
        const scene = new THREE.Scene();
        const camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);
        const renderer = new THREE.WebGLRenderer();
        renderer.setSize(window.innerWidth, window.innerHeight);
        renderer.setClearColor(0x000000); // 使用黑色作為清除顏色
        document.body.appendChild(renderer.domElement);

        const controls = new OrbitControls(camera, renderer.domElement);
        controls.update();

        camera.position.z = 5;

        // 加載 VRM 模型
        const loader = new GLTFLoader();
        loader.load('project.vrm', function (gltf) {
            // 在回調函數中添加 VRM 模型到場景中
            const vrmModel = gltf.scene;

            vrmModel.rotation.y = Math.PI; // 180 度旋轉，使其朝向 Z 軸正方向
            vrmModel.scale.set(10, 10, 10); // 將模型在三個軸向上都放大為原來的兩倍
            vrmModel.position.y = -8; // 向下移動一個單位（假設模型的高度為 2）
            vrmModel.rotation.x = Math.PI / 30; // 將模型向前傾斜 30 度（單位為弧度）
            vrmModel.traverse((child) => {
                if (child.isMesh && child.name.includes('upperBody')) {
                    scene.add(child);
                }
            });
            scene.add(vrmModel);

            // 创建 AnimationMixer 实例
            const mixer = new THREE.AnimationMixer(vrmModel);

            // 获取眨眼动画
            const blinkAction = mixer.clipAction(gltf.animations.find((clip) => clip.name === 'Blink'));

            // 播放眨眼动画
            blinkAction.play();
        }, undefined, function (error) {
            console.error('Failed to load VRM model:', error);
        });

        function animate() {
            requestAnimationFrame(animate);
            renderer.render(scene, camera);
        }

        animate();
    </script>


</body>

</html>
